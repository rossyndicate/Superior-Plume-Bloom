---
title: "Move labels to repo"
author: "ROSSyndicate"
date: "2023-07-20"
output: html_document
---

```{r setup, echo = F}
packages <- c('tidyverse',
              'googledrive')

package_loader <- function(x) {
    if (x %in% installed.packages()) {
      library(x, character.only = TRUE)
    } else {
      install.packages(x)
      library(x, character.only = TRUE)
    }
}

lapply(packages, package_loader)
```

# Purpose

This script moves the collated labels dataset from the Drive folder to the local repository and deletes previous versions from the local repository.

First step is to identify the version date we're interested in:

```{r}
v_date = '2023-07-20'
```

## Download collated files from eePlumB users

Authenticate Drive

```{r}
drive_auth()
```

Some helper functions

```{r}
drive_downloader = function(driveid, drivename, dest) {
  drive_download(as_id(driveid), path = file.path(dest, drivename), overwrite = T)
}
```

Find the collated labels data file for our version date

```{r}
# grab all the file info from the collated folder
collated = drive_ls(path = 'eePlumB_collated_data')
# get the right version date
collated_version = collated[grepl(v_date, collated$name),]
# grab just the labels (not the validation data)
labels = collated_version[grepl('label', collated_version$name),]
```

Download the file to the data folder and then read into environment

```{r}
# if the labels directory exists
if (dir.exists('data/labels/')) {
  # delete it and its contents
  unlink('data/labels/', recursive = T)
  # then recreate
  dir.create('data/labels/')
  # and download the labels file locally
  drive_downloader(labels$id[1], labels$name[1], 'data/labels/')
} else {
  dir.create('data/labels/')
  drive_downloader(labels$id[1], labels$name[1], 'data/labels/')
}
```
