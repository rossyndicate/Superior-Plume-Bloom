---
title: "Move labels to repo"
author: "ROSSyndicate"
date: "2024-03-07"
output: html_document
---

```{r setup, echo = F}
# get all the functions from the src folder and load them
source_files <- list.files("src", full.names = T)
invisible(lapply(source_files, source))

# list/load/download the packages needed for this script
packages <- c('tidyverse',
              'googledrive')
invisible(lapply(packages, package_loader))
```

# Purpose

This script moves the collated labels datasets from the Drive folder to the local repository.

Authenticate Drive - these files are located in the ROSS account. Reach out for credentials.

```{r}
drive_auth(email = "therossyndicate@gmail.com")
```

Also, identify the version date we're interested in:

```{r}
# date for original collation
og_collation_date = "2023-07-20"
# date for secondary collation
add_data_date = "2024-03-07"
```

## Download collated files from eePlumB users

This file was created in `eePlumB/2_data_ingestion/1_data_download.Rmd`.

Find the collated labels data file for our version date

```{r}
# grab all the file info from the collated folder
collated = drive_ls(path = 'eePlumB_collated_data')
# get the right version date
collated_version = collated[grepl(og_collation_date, collated$name),]
# grab just the labels (not the validation data)
labels = collated_version[grepl('label', collated_version$name),]
```

Retrieve the file from drive

```{r}
collated_file <- retrieve_drive_file(driveid = labels$id)
```

## Download the files created using 'data_re_pull' scripts in \`eePlumB/2_data_ingestion\`

Make a list of the files in the drive and download them to a tmp folder

```{r}
add_data_list <- drive_ls(path = "eePlumB_additional_band_data")

# and download the files to that folder
labels_add_bands <- map_df(add_data_list$id,
                           retrieve_drive_file) %>% 
  bind_rows()
```
